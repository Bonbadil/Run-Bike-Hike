"use strict;";var Controller=function(){function n(){DB.initiate(e,t),navigator.geolocation&&(A=navigator.geolocation.watchPosition(function(n){o(n)},function(n){a(n)}))}function e(){DB.getConfig(u,l)}function t(n){utils.status.show(n)}function o(n){Y?r(n):HomeView.updateInfos(n)}function a(n){Y?s(n):HomeView.displayError(n)}function c(){Y?document.getElementById("views").showCard(2):(Y=!0,Chrono.load(document.getElementById("home-chrono")),Chrono.start(),current_track=Tracks.open(),nb_point=0,document.querySelector("#btn-start").innerHTML="Stop",document.querySelector("#btn-start").className="align-right danger big alternate")}function i(){Chrono.stop(),Tracks.reset(),Chrono.reset();var n=Tracks.close();Y=!1,console.log("track is",n),0===n.data.length?(console.log("Track empty. Not saving"),utils.status.show("Track empty. Not saving")):DB.addTrack(h,v,n),document.querySelector("#btn-start").innerHTML="Start",document.querySelector("#btn-start").className="align-right recommend big alternate"}function r(n){if(n.coords&&n.coords.latitude&&n.coords.longitude){var e=n.coords,t=(new Date,e.speed);lat=e.latitude.toFixed(6),lon=e.longitude.toFixed(6);{var o=e.altitude,a=new Date(n.timestamp).toISOString(),c=e.accuracy.toFixed(0),i=e.altitudeAccuracy.toFixed(0);e.heading.toFixed(0)}(-200>o||0===o&&0===i)&&(o=null);var r=Tracks.getDistance(lat,lon);G=Tracks.getDuration(n.timestamp);var s={latitude:lat,longitude:lon,altitude:o,date:a,speed:t,accuracy:c,vertAccuracy:i};Tracks.addNode(s,r,G)}}function s(){}function u(n){P=n,y(n)}function l(n){console.log("__getConfigError ",n)}function d(n,e){P[n]=e,console.log("saving:",n+" "+e),console.log("now settings:",P),DB.updateConfig(g,f,n,e)}function g(){console.log("YES !")}function f(n){console.log("NO !",n)}function k(n){console.log("inChecked",n),n?(O=window.navigator.requestWakeLock("screen"),window.addEventListener("unload",function(){O.unlock()})):window.navigator.requestWakeLock("screen").unlock()}function m(n){P.language=n}function p(n){P.distance=n}function T(n){P.speed=n}function w(n){P.position=n}function y(n){document.getElementById("screen").checked=n.screen,document.getElementById("language").value=n.language,document.getElementById("distance").value=n.distance,document.getElementById("speed").value=n.speed,document.getElementById("position").value=n.position}function h(n){utils.status.show("Track "+n+" sucessfully saved.")}function v(n){utils.status.show(n)}function B(){TracksView.reset(),DB.getTracks(D,E)}function D(n){console.log("inTracks to display are",n),TracksView.display(n,C)}function E(){}function C(n){console.log("inTrack display: ",n),X=n,TrackView.display(n,b)}function S(n){X=n,TrackView.display(n)}function I(){DB.deleteTrack(N,V,X),console.log("delete track: ",X)}function N(){TracksView.reset(),B()}function V(){}function b(n){console.log("saving inTrack in Controller",n),DB.saveMap(q,x,n)}function q(){}function x(){}function L(n){j=n}function F(){return X.name}function H(n){X.name=n,console.log("track name is now ",X.name),DB.updateTrack(W,_,X)}function W(){TrackView.updateName(X.name),document.getElementById("views").showCard(4)}function _(){}function M(){ExportTrack.toGPX(X)}var P,A,O,G,X,Y=!1,j=!1;return{init:n,toggleWatch:c,stopWatch:i,displayTracks:B,displayTrack:S,deleteTrack:I,savingSettings:d,toogleScreen:k,changeLanguage:m,changeDistance:p,changeSpeed:T,changePosition:w,flippingTrack:L,getTrackName:F,renameTrack:H,shareTrack:M}}();